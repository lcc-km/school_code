<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE en-export SYSTEM "http://xml.evernote.com/pub/evernote-export2.dtd">
<en-export export-date="20181022T062252Z" application="Evernote/Windows" version="6.x">
<note><title>RNAseq gene表达量分析 （有参考genome）</title><content><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd">

<en-note><div><div>原始流程from wh（.sh文件给出了多个样品批量运行时的linux脚本）</div><div><en-media hash="67baae40e6023648507cbbfeca7e916d" type="application/octet-stream"/></div><div>主要步骤：&nbsp;</div><ol><li><div>trimmomatic： 去接头、除低质量reads、截取高质量碱基reads</div></li><ul><li><div><a href="http://www.usadellab.org/cms/index.php?page=trimmomatic">http://www.usadellab.org/cms/index.php?page=trimmomatic</a></div></li></ul><li><div>hisat2：比对，过滤后 reads比对到genome上，生成sam文件</div></li><ul><li><div><a href="https://ccb.jhu.edu/software/hisat2/index.shtml">https://ccb.jhu.edu/software/hisat2/index.shtml</a></div></li></ul><li><div>samtools： 对sam文件进行sort，生成bam</div></li><ul><li><div><a href="http://samtools.sourceforge.net/">http://samtools.sourceforge.net/</a></div></li></ul><li><div>stringtie： 根据genome注释文件，和比对的结果bam，得到各样本在各transcript的信息</div></li><ul><li><div><a href="http://ccb.jhu.edu/software/stringtie/">http://ccb.jhu.edu/software/stringtie/</a></div></li></ul><li><div>edgeR或DEseq2（R的package）： 根据raw counts 计算差异表达基因</div></li><ul><li><div><a href="http://ccb.jhu.edu/software/stringtie/index.shtml?t=manual">http://ccb.jhu.edu/software/stringtie/index.shtml?t=manual</a></div></li></ul></ol><div><b><br/></b></div><div><b><font style="font-size: 12pt;">单个样品运行步骤举例：</font></b></div><div><br/></div><div>##<span>&nbsp; &nbsp;1-</span>trimmomatic：</div><div>java -jar&nbsp;&nbsp;<font><font style="color: rgb(28, 51, 135);">/</font><font style="color: rgb(50, 135, 18);">home/wenhao/tools/Trimmomatic-0.33/trimmomatic-0.33.jar</font></font> PE -phred33 sample_R1.fq.gz sample_R2.fq.gz sample_R1_clean.fq.gz sample_R1_unpaired_prepeocessing.fq.gz sample_R2_clean.fq.gz sample_R2_unpaired_preprocessing.fq.gz ILLUMINACLIP:<font style="color: rgb(235, 0, 115);">/home/wenhao/tools/Trimmomatic-0.33/adapters/</font><font style="color: rgb(235, 0, 115);">TruSeq3-PE.fa:</font><font style="color: rgb(45, 79, 201);"><b>2:30:10</b> <b>HEADCROP:9 CROP:135 AVGQUAL:20 TRAILING:20 MINLEN:50</b></font></div><div><br/></div><div># 说明：&nbsp;<span style="color: rgb(235, 0, 115);">TruSeq3-PE.fa:</span> 文库构建接头信息文件，转录组测序文库构建使用 illumina 的 TruSeq3 kit的接头</div><div><span>#<span>&nbsp;蓝色部分参数根据需求可调整，详见trimmomatic说明书</span></span><br/></div><div><span><br/></span></div><div><span><br/></span></div><div><span><br/></span></div><div>##&nbsp; &nbsp;2-hisat2：</div><div>## -1）根据gtf生成索引文件<br/></div><div>hisat2-build -p 15 --ss Danio_rerio.GRCz10.85.ss --exon Danio_rerio.GRCz10.85.exon&nbsp;&nbsp;Danio_rerio.GRCz10.dna.toplevel.fa Danio_rerio.GRCz10.dna.toplevel</div><div><br/></div><div># 添加--ss和--exon选项后，需要很大的内存，build 人基因组的话需要～200G RAM，如果没有这么大内存，不要添加这两个选项，但要在后续运行hisat时添加 --known-splicesite-infile选项</div><div><br/></div><div><br/></div><div>##&nbsp; -2）比对</div><div>hisat2 <b>-p 16</b> --dta-cufflinks --no-softclip -x Danio_rerio.GRCz10.dna.toplevel -1&nbsp;sample_R1_clean.fq.gz -2&nbsp;sample_R2_clean.fq.gz -S sample.sam</div><div><br/></div><div><br/></div><div>##&nbsp; 3--- samtools</div><div>samtools sort <b>-@ 8</b> -o&nbsp;sample.bam sample.sam<br/></div><div><br/></div><div>#说明：<b>-@ 8</b>: 使用8个线程</div><div><br/></div><div><br/></div><div>##&nbsp; 4--- stringtile :&nbsp;</div><div>## -1）获取transcript的表达量</div><div>stringtie -e -B -<b>p 15</b> -G Danio_rerio.GRCz10.85.LD4.gtf -o ./sample.sam/sample.sam.gtf&nbsp;&nbsp;sample.sam</div><div><br/></div><div>## -2）获取counts数</div><div>#先将上一步stingtile的结果（.gtf）与prepDE.py 置于同一个文件夹,然后运行：</div><div>python <b>prepDE.py</b></div><div><br/></div><div># 说明，需要python 2.7以上版本</div><div># 亦可使用&nbsp;<span style="font-size: 9pt;">prepDE.py -i sample_lst.txt 说明gtf文件的位置</span></div><div><br/></div><div><br/></div><div>##&nbsp; 4--- DEseq2 :&nbsp;</div><div>#参见如下：<br/></div><div><span style="font-size: 9pt;"><b>Protocol: Using StringTie with DESeq2</b></span><br/></div><ol><li><div><font style="font-size: 9pt;">Generate count matrices using prepDE.py</font></div></li><ol type="a"><li><div><font style="font-size: 9pt;">Assuming default ballgown directory structure produced by StringTie</font></div><div><font style="font-size: 9pt;">$ python prepDE.py</font></div></li><li><div><font style="font-size: 9pt;">List of GTFs sample IDs and paths (<a href="http://ccb.jhu.edu/software/stringtie/dl/sample_lst.txt">sample_lst.txt</a>)</font></div><div><font style="font-size: 9pt;">$ python prepDE.py -i sample_lst.txt</font></div></li></ol><li><div><font style="font-size: 9pt;"><a href="https://cran.r-project.org/">Install R</a> and DESeq2. Upon installing R, install DESeq2 on R:</font></div><div><font style="font-size: 9pt;">&gt; source(&quot;<a href="https://bioconductor.org/biocLite.R">https://bioconductor.org/biocLite.R</a>&quot;)</font></div><div><font style="font-size: 9pt;">&gt; biocLite(&quot;DESeq2&quot;)</font></div></li><li><div><font style="font-size: 9pt;">Import DESeq2 library in R</font></div><div><font style="font-size: 9pt;">&gt; library(&quot;DESeq2&quot;)</font></div></li><li><div><font style="font-size: 9pt;">Load gene(/transcript) count matrix and labels</font></div><div><font style="font-size: 9pt;">&gt; countData &lt;- as.matrix(read.csv(&quot;gene_count_matrix.csv&quot;, row.names=&quot;gene_id&quot;))</font></div><div><font style="font-size: 9pt;">&gt; colData &lt;- read.csv(PHENO_DATA, sep=&quot;\t&quot;, row.names=1)</font></div><div><font style="font-size: 9pt;">Note: The PHENO_DATA file contains information on each sample, e.g., sex or population. The exact way to import this depends on the format of the file.</font></div></li><li><div><font style="font-size: 9pt;">Check all sample IDs in colData are also in CountData and match their orders</font></div><div><font style="font-size: 9pt;">&gt; all(rownames(colData) %in% colnames(countData))</font></div><div><font style="font-size: 9pt;">[1] TRUE</font></div><div><font style="font-size: 9pt;">&gt; countData &lt;- countData[, rownames(colData)]</font></div><div><font style="font-size: 9pt;">&gt; all(rownames(colData) == colnames(countData))</font></div><div><font style="font-size: 9pt;">[1] TRUE</font></div></li><li><div><font style="font-size: 9pt;">Create a DESeqDataSet from count matrix and labels</font></div><div><font style="font-size: 9pt;">&gt; dds &lt;- DESeqDataSetFromMatrix(countData = countData,</font></div><div><font style="font-size: 9pt;">        colData = colData, design = ~ CHOOSE_FEATURE)</font></div></li><li><div><font style="font-size: 9pt;">Run the default analysis for DESeq2 and generate results table</font></div><div><font style="font-size: 9pt;">&gt; dds &lt;- DESeq(dds)</font></div><div><font style="font-size: 9pt;">&gt; res &lt;- results(dds)</font></div></li><li><div><font style="font-size: 9pt;">Sort by adjusted p-value and display</font></div><div><font style="font-size: 9pt;">&gt; (resOrdered &lt;- res[order(res$padj), ])</font></div></li></ol><div><br/></div></div></en-note>]]></content><created>20181022T043108Z</created><updated>20181022T062004Z</updated><note-attributes><author>wangjian09@fudan.edu.cn</author><source>desktop.win</source><source-url>http://site.team.zju.edu.cn/scu/redir.php?catalog_id=58400&amp;object_id=204719</source-url><source-application>evernote.win32</source-application></note-attributes><resource><data encoding="base64">
I3RyaW1tb21hdGljDQoNCmZvciBpIGluIGBscyAqX1IxLmZxLmd6YA0KZG8gDQp4PSR7aS8xLmZx
Lmd6L30NCmVjaG8gamF2YSAtamFyICAvaG9tZS93ZW5oYW8vdG9vbHMvVHJpbW1vbWF0aWMtMC4z
My90cmltbW9tYXRpYy0wLjMzLmphciBQRSAtcGhyZWQzMyBcDQoke3h9IjEuZnEuZ3oiICR7eH0i
Mi5mcS5neiIgJHt4fSIxX2NsZWFuLmZxLmd6IiAke3h9IjFfdW5wYWlyZWRfcHJlcGVvY2Vzc2lu
Zy5mcS5neiIgXA0KJHt4fSIyX2NsZWFuLmZxLmd6IiAke3h9IjJfdW5wYWlyZWRfcHJlcHJvY2Vz
c2luZy5mcS5neiIgXA0KSUxMVU1JTkFDTElQOi9ob21lL3dlbmhhby90b29scy9UcmltbW9tYXRp
Yy0wLjMzL2FkYXB0ZXJzL1RydVNlcTMtUEUuZmE6MjozMDoxMCBIRUFEQ1JPUDo5IENST1A6MTM1
IEFWR1FVQUw6MjAgVFJBSUxJTkc6MjAgTUlOTEVOOjUwDQpkb25lID4gdHJpbW1vbWF0aWMuc2gN
Cg0KDQojIyAyLS0taGlzYXQyDQoNCiNoaXNhdDItYnVpbGQgLXAgMTUgLS1zcyBEYW5pb19yZXJp
by5HUkN6MTAuODUuc3MgLS1leG9uIERhbmlvX3JlcmlvLkdSQ3oxMC44NS5leG9uICBEYW5pb19y
ZXJpby5HUkN6MTAuZG5hLnRvcGxldmVsLmZhIERhbmlvX3JlcmlvLkdSQ3oxMC5kbmEudG9wbGV2
ZWwNCg0KZm9yIGkgaW4gYGxzICoxX2NsZWFuLmZxLmd6YA0KZG8NCng9JHtpLzFfY2xlYW4uZnEu
Z3ovfQ0KZWNobyBoaXNhdDIgLXAgMTYgLS1kdGEtY3VmZmxpbmtzIC0tbm8tc29mdGNsaXAgLXgg
L2hvbWUvd2VuaGFvL3dvcmsvOV9vdmVyeV90ZW1wZXJhdHVyZV9CUy1zZXEvMTBfbHdoX3RlbXBl
cmF0dXJlX1JOQS1zZXEvRGFuaW9fcmVyaW8uR1JDejEwLmRuYS50b3BsZXZlbCAtMSAkaSAtMiAk
e3h9IjJfY2xlYW4uZnEuZ3oiIC1TICR7eH0iLnNhbSIgMlw+ICR7eH0iLmxvZyINCmRvbmUgPiB0
b3RhbC5oaXNhdDIuc2gNCg0KDQojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMj
IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMj
IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMj
IyMjIyMjDQoNCiMjIDMtLS0gc2FtMmJhbSBhbmQgc29ydA0KDQpmb3IgaSBpbiBgbHMgKi5zYW1g
DQpkbw0KeD0ke2kvLnNhbS99DQplY2hvIHNhbXRvb2xzIHNvcnQgLUAgOCAtbyAke3h9Ii5iYW0i
ICRpDQpkb25lID4gc2FtdG9vbHMuc2gNCg0Kbm9odXAgUGFyYUZseSAtYyBzYW10b29scy5zaCAt
Q1BVIDkgJg0KDQojIyA0LS0tIHN0cmluZ3RpZQ0KDQpmb3IgaSBpbiBgbHMgKi5iYW1gDQpkbw0K
eD0ke2kvLmJhbS99DQplY2hvIHN0cmluZ3RpZSAtZSAtQiAtcCAxNSAtRyAvaG9tZS9ydWlxaW4v
ZGF0YS96ZWJyYWZpc2hfZ2Vub21lL0RhbmlvX3JlcmlvLkdSQ3oxMC44NS5MRDQuZ3RmICAgICAg
ICAtbyAvaG9tZS9ydWlxaW4vZGF0YS90cmFuc2NyaXB0b20vQ0hHMDMwNTg1LyR4LyR4Lmd0ZiAg
JGkNCmRvbmUgPiBzdHJpbmd0aWUuZ2Vub21lX2Fubm90YXRpb24uc2gNCg0KIyMtLS0tLS0tLURF
R3NlcSDlt67lvILln7rlm6ANCg0KbWtkaXIgYmFsbGdvd24NCg0KI2NwIC1yIDNfZGVub3ZvX2Nv
dW50IC4uL2JhbGxnb3duDQphbGlhcyBweXRob24yPScvaG9tZS93ZW5oYW8vdG9vbHMvcHl0aG9u
MjcvYmluL3B5dGhvbicNCnB5dGhvbjIgcHJlcERFLnB5ICPkuI5iYWxsZ293buWcqOWQjOS4gOS4
quebruW9leS4re+8jOWImeiHquWKqOiuoeeul2NvdW505pWwDQoNCg0KDQoNCg==
</data><mime>application/octet-stream</mime><resource-attributes><source-url>file://C:\Users\wang\AppData\Local\Temp\RNA_seq_hisat2_stringtie_DEseq2.sh</source-url><file-name>RNA_seq_hisat2_stringtie_DEseq2.sh</file-name><attachment>true</attachment></resource-attributes></resource></note></en-export>
